<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Leaflet Map Template</title>

        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@geoman-io/leaflet-geoman-free@2.17.0/dist/leaflet-geoman.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/leaflet-measure@3.1.0/dist/leaflet-measure.css"
        />

        <style>
            html,
            body {
                height: 100%;
                overflow: hidden;
            }

            #map {
                height: calc(98vh - 40px);
                width: 100%;
                border-radius: 0.375rem;
            }

            .panel-scroll {
                height: 98vh;
                overflow-y: auto;
            }

            .card {
                border-radius: 0.375rem;
            }

            .card-header {
                padding: 0.5rem 0.75rem;
            }

            .card-body {
                padding: 0.75rem;
            }

            .wms-feature-popup .leaflet-popup-content-wrapper {
                padding: 0;
                border-radius: 6px;
                overflow: hidden;
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            }

            .wms-feature-popup .leaflet-popup-content {
                margin: 0;
                line-height: 1.4;
            }

            .wms-feature-popup .leaflet-popup-tip {
                box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            }
        </style>
    </head>

    <body class="bg-light">
        <div class="container-fluid mt-2">
            <div class="row g-2">
                <!-- Cot 1: Ban do -->
                <div class="col-lg-8">
                    <div class="card shadow-sm h-100">
                        <div
                            class="card-header d-flex align-items-center justify-content-between py-1"
                        >
                            <h6 class="mb-0 small">
                                <i class="bi bi-geo-alt-fill text-danger"></i>
                                Ban do
                            </h6>
                            <span
                                class="badge bg-success"
                                id="mapStatus"
                                style="font-size: 0.7rem"
                                >San sang</span
                            >
                        </div>
                        <div class="card-body p-1">
                            <div id="map"></div>
                        </div>
                    </div>
                </div>

                <!-- Cot 2: Cong cu -->
                <div class="col-lg-4">
                    <div class="panel-scroll">
                        <!-- Loc theo dia gioi -->
                        <div class="card shadow-sm mb-2">
                            <div class="card-header py-1">
                                <h6 class="mb-0 small">
                                    <i
                                        class="bi bi-funnel-fill text-primary"
                                    ></i>
                                    Loc theo dia gioi
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <label
                                        class="form-label small fw-semibold mb-1"
                                        >Tinh / Thanh pho</label
                                    >
                                    <select
                                        class="form-select form-select-sm"
                                        id="province_code"
                                    >
                                        <option value="">
                                            [Chon tinh/thanh pho]
                                        </option>
                                    </select>
                                </div>
                                <div class="mb-2">
                                    <label
                                        class="form-label small fw-semibold mb-1"
                                        >Xa / Phuong</label
                                    >
                                    <select
                                        class="form-select form-select-sm"
                                        id="commune_code"
                                    >
                                        <option value="">
                                            [Chon xa/phuong]
                                        </option>
                                    </select>
                                </div>
                                <button
                                    class="btn btn-outline-secondary btn-sm w-100"
                                    onclick="resetFilter()"
                                >
                                    <i class="bi bi-arrow-counterclockwise"></i>
                                    Xoa bo loc
                                </button>
                            </div>
                        </div>

                        <!-- Quan ly lop WMS -->
                        <div class="card shadow-sm mb-2">
                            <div
                                class="card-header py-1"
                                role="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#wmsPanel"
                            >
                                <h6 class="mb-0 small">
                                    <i
                                        class="bi bi-layers-fill text-success"
                                    ></i>
                                    Quan ly lop WMS
                                </h6>
                            </div>
                            <div class="collapse show" id="wmsPanel">
                                <div
                                    class="card-body p-0"
                                    id="wmsListContainer"
                                ></div>
                            </div>
                        </div>

                        <!-- Quan ly diem -->
                        <div class="card shadow-sm mb-2">
                            <div
                                class="card-header py-1"
                                role="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#pointPanel"
                            >
                                <h6 class="mb-0 small">
                                    <i class="bi bi-geo-fill text-danger"></i>
                                    Quan ly diem
                                </h6>
                            </div>
                            <div class="collapse" id="pointPanel">
                                <div class="card-body">
                                    <div
                                        id="pointListContainer"
                                        class="mb-2"
                                    ></div>
                                    <div class="row g-1 mb-2">
                                        <div class="col-6">
                                            <input
                                                type="number"
                                                step="any"
                                                class="form-control form-control-sm"
                                                id="pointLat"
                                                placeholder="Vi do"
                                            />
                                        </div>
                                        <div class="col-6">
                                            <input
                                                type="number"
                                                step="any"
                                                class="form-control form-control-sm"
                                                id="pointLng"
                                                placeholder="Kinh do"
                                            />
                                        </div>
                                    </div>
                                    <div class="mb-2">
                                        <input
                                            type="text"
                                            class="form-control form-control-sm"
                                            id="pointName"
                                            placeholder="Ten diem"
                                        />
                                    </div>
                                    <div class="d-grid gap-1">
                                        <button
                                            class="btn btn-danger btn-sm"
                                            onclick="addCustomPoint()"
                                        >
                                            <i class="bi bi-plus-circle"></i>
                                            Them diem
                                        </button>
                                        <div class="btn-group btn-group-sm">
                                            <button
                                                class="btn btn-outline-secondary"
                                                onclick="toggleAllPoints()"
                                            >
                                                <i class="bi bi-eye"></i>
                                                An/Hien
                                            </button>
                                            <button
                                                class="btn btn-outline-secondary"
                                                onclick="zoomAllPoints()"
                                            >
                                                <i
                                                    class="bi bi-arrows-fullscreen"
                                                ></i>
                                                Xem tat ca
                                            </button>
                                            <button
                                                class="btn btn-outline-danger"
                                                onclick="clearAllPoints()"
                                            >
                                                <i class="bi bi-trash"></i> Xoa
                                                het
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sketch Tools -->
                        <div class="card shadow-sm mb-2">
                            <div
                                class="card-header py-1"
                                role="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#sketchPanel"
                            >
                                <h6 class="mb-0 small">
                                    <i
                                        class="bi bi-pencil-square text-warning"
                                    ></i>
                                    Ve va chinh sua
                                </h6>
                            </div>
                            <div class="collapse" id="sketchPanel">
                                <div class="card-body">
                                    <button
                                        class="btn btn-warning btn-sm w-100"
                                        id="sketch-toggle-btn"
                                        onclick="toggleSketchMode()"
                                    >
                                        <i class="bi bi-pencil"></i> Bat sketch
                                        tools
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="https://unpkg.com/@turf/turf@7/turf.min.js"></script>
        <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@2.17.0/dist/leaflet-geoman.min.js"></script>
        <script src="https://unpkg.com/leaflet-measure@3.1.0/dist/leaflet-measure.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.9.0/proj4.js"></script>

        <!-- Module 1: WFSUtil -->
        <script src="assets/js/leaflet/leaflet-wfs-util.js"></script>
        <!-- Module 2: WMSLayerManager -->
        <script src="assets/js/leaflet/leaflet-wms-manager.js"></script>
        <!-- Module 3: PointManager -->
        <script src="assets/js/leaflet/leaflet-point-manager.js"></script>
        <!-- Module 4: SketchManager -->
        <script src="assets/js/leaflet/leaflet-sketch-manager.js"></script>

        <script src="assets/js/http-request/fetch.js"></script>
        <script src="assets/js/auto-fill/fill-select.js"></script>
        <script src="assets/js/province-commune-select/events.js"></script>
        <script src="assets/js/province-commune-select/load-fill.js"></script>

        <!-- Map Application Core -->
        <script src="assets/js/map-config.js"></script>
        <script src="assets/js/map-core.js"></script>
        <script src="assets/js/index.js"></script>
    </body>
</html>
